# Bug: Mise-VCFが三/四を作らないミセ手を検出してしまう

## 概要

`findMiseVCFSequence` がミセターゲット（四三点）の存在だけを確認し、ミセ手自体が三や四を作るかを検証していない。三も四も作らないミセ手は強制手にならないため、Mise-VCFとして検出するのは誤り。

## 再現対局

- 分析ファイル: `bench-results/bench-2026-02-20T03-15-21-203Z.json`
- 対局 #121: B wins by five, 61手

## 症状

- m42 (W): K13 が score=100000 (FIVE) で Mise-VCF として検出される
- K13 は I11 への四三セットアップ（ミセ）を作るが、K13 自体は三も四も作っていない
- 防御が強制されないため、黒は I11 ではなく K10 を選択
- 結果として白は勝ちを逃し、最終的に黒が61手で勝利

### 盤面 (m42着手前)

```
   A B C D E F G H I J K L M N O
15 . . . . . . . . . . . . . . .
14 . . . . . . . O O . . . . . .
13 . . . . . . . X X . . . . . .
12 . . . . . . X O X O . . . . .
11 . . . . O X . O . . O . . . .
10 . . . . X X O O . X . . . . .
 9 . . . O X O X X X O O X . . .
 8 . . . . X O O X X X . . . . .
 7 . . . . X . O X O . . . . . .
 6 . . . . O . . O . . . . . . .
 5 . . . . . . . . O . X . . . .
 4 . . . . . . . . . X . . . . .
 3 . . . . . . . . . . . . . . .
 2 . . . . . . . . . . . . . . .
 1 . . . . . . . . . . . . . . .
```

### K13の4方向分析

| 方向     | 内容           | 三/四    |
| -------- | -------------- | -------- |
| 列K (↓)  | K13 → 空 → K11 | 2石+隙間 |
| 行13 (→) | K13のみ        | 1石      |
| 対角↘    | K13のみ        | 1石      |
| 対角↙    | K13 → J12      | 2石      |

**三も四も作っていない。**

## 想定される原因

`findMiseVCFSequence` (`src/logic/cpu/search/miseVcf.ts` L92-199) のアルゴリズム:

1. 候補手Mを配置
2. `findMiseTargetsLite` でミセターゲット（四三点T）を検出
3. Tに相手石を配置（防御）
4. VCF探索

ステップ2-4は正しいが、**Mが三/四を作るかの検証がない**。正当なMise-VCF（ミセ四追い）では、ミセ手自体が三や四を作り、相手に応手を強制する必要がある。

### 正当なMise-VCFの例

- G7 (既存テスト): 活三（G7-H7-I7、行8、両端空き）を作る → 相手は三を止める必要がある → 強制
- H7 (Game 185): 飛び三（H10-\_-H8-H7、列H）を作る → 相手は三を止める必要がある → 強制

### 不正なMise-VCF（今回のバグ）

- K13 (Game 121): 三も四も作らない → 相手に応手の義務がない → 非強制

## 関連する副次的問題

Game 121では、Mise-VCF検出の誤りに加えて2つの問題が観察された:

1. **黒の防御漏れ (m43)**: 白K13の後、黒がI11（四三点）を抑えずK10を選択。相手のミセ手を検知できていない
2. **白の攻撃漏れ (m44)**: K10の後、VCF(I11→L14→J11)が存在するのにJ11を選択。VCF/四三の検出・選択に問題

## 確認方法

```bash
pnpm debug:vcf bench-results/bench-2026-02-20T03-15-21-203Z.json 121 42
```

## 修正方針

`findMiseVCFSequence` にミセ手の強制性チェックを追加:

- ミセ手配置後、`getCreatedOpenThreeDefenses` (ノリ手プランで追加予定) が空の場合 → 三を作っていない → Mise-VCFとして検出しない
- ノリ手プラン (`docs/plan-mise-vcf-nori-te.md`) と統合可能:
  - 三を作らない → 却下（本バグの修正）
  - 三を作る → 三防御位置でVCFを検証（ノリ手の修正）

## 修正状況

- [x] 原因特定
- [x] 修正実装（ノリ手プランと統合: 強制性チェック `createsFour` + `getCreatedOpenThreeDefenses`）
- [x] テスト追加（`miseVcf.test.ts` Game 121テスト）
