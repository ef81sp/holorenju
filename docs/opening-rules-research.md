# 連珠開局規定の調査レポート

## 概要

### なぜ開局規定が必要か

連珠では**先手（黒）の必勝法**が解明されており、禁手（三三禁、四四禁、長連禁）を設けても単純に黒白が交互に打つだけでは先手が必ず勝てることが確立されています。

そのため、競技として成立させるために様々な**開局規定**が考案され、両対局者間の均衡を保っています。

---

## 開局規定の一覧と比較

| 規定名 | 別名 | 採用期間 | 複雑度 | 特徴 |
|--------|------|----------|--------|------|
| 自由打ち | Free | 初心者向け | ★☆☆☆☆ | 制限なし、先手必勝 |
| 珠型交替五珠自由打ち | Swap | 古典 | ★★☆☆☆ | 3手目後にスワップ |
| 珠型交替五珠二題打ち | RIF/2題打ち | 〜2008年 | ★★★☆☆ | 黒5を2題提示 |
| 珠型五珠題数提示選択打ち | Yamaguchi | 2009〜2016年 | ★★★★☆ | 題数を事前宣言 |
| 四珠交代打ち | Soosõrv-8 | 2017〜2024年 | ★★★★★ | 白4と題数を同時指定 |
| 五珠交代打ち | Taraguchi-10 | 2024年〜 | ★★★★☆ | 毎手スワップ可能 |

---

## 各開局規定の詳細

### 1. 自由打ち（Free Opening）

**対象**: 初心者向け

**手順**:
1. 黒が天元（中央）に打つ
2. 白が任意の場所に打つ
3. 以降は交互に自由に打つ

**特徴**:
- 最もシンプル
- 先手必勝のため競技には不向き
- **現在のCPU戦で採用中**

---

### 2. 珠型交替五珠自由打ち（Simple Swap）

**対象**: 入門〜初級者

**手順**:
```
1. [仮先] 26珠型の1つを盤上に配置（黒1・白2・黒3）
2. [仮後] 黒を持つか白を持つか選択（スワップ）
3. [白]   白4を打つ
4. [黒]   黒5を打つ
5. 以降は交互に自由に打つ
```

**特徴**:
- 珠型を置いた側が不利な場合、相手に黒を持たせられる
- シンプルで理解しやすい

**アルゴリズム実装のポイント**:
- 珠型選択: 26珠型から評価値に基づいて選択
- スワップ判定: 珠型の有利度（黒勝率）で判断
  - 黒有利すぎる → スワップして黒を取る
  - 白有利すぎる → スワップして白を取る

---

### 3. 珠型交替五珠二題打ち（RIF Rule）

**対象**: 中級者〜

**採用期間**: 国際標準（〜2008年）

**手順**:
```
1. [仮先] 26珠型の1つを配置
2. [仮後] スワップ選択
3. [白]   白4を打つ
4. [黒]   黒5の候補を2ヶ所提示
5. [白]   2つから1つを選び、白6を打つ
6. 以降は交互に自由に打つ
```

**特徴**:
- 黒5を2つ提示することで、一方的に有利な手を打てない
- クラシックな連珠体験

**アルゴリズム実装のポイント**:
- 黒5の2題提示: 勝率が近い2手を選択
  - どちらを選ばれても大差ないバランスを目指す
- 白の選択: より有利な（黒の勝率が低い）黒5を選択

---

### 4. 珠型五珠題数提示選択打ち（Yamaguchi Rule）

**対象**: 上級者

**採用期間**: 2009〜2016年（国際標準）

**手順**:
```
1. [仮先] 26珠型の1つを配置し、黒5の題数（1〜5）を宣言
2. [仮後] スワップ選択
3. [白]   白4を打つ
4. [黒]   宣言した題数だけ黒5候補を提示（対称形不可）
5. [白]   候補から1つを選び、白6を打つ
6. 以降は交互に自由に打つ
```

**特徴**:
- 珠型の強さに応じて題数を調整可能
- 強い珠型（黒必勝）は多くの題数を宣言しないとスワップされる

**アルゴリズム実装のポイント**:
- 題数決定: 珠型の黒勝率に応じて決定
  - 黒必勝珠型 → 多め（4〜5題）
  - 未解明珠型 → 少なめ（1〜2題）
- 候補提示: 勝率のバランスが取れた手を選択

---

### 5. 四珠交代打ち（Soosõrv-8 Rule）

**対象**: 上級者・競技者

**採用期間**: 2017〜2024年（国際標準）

**別名**: ソーソロフルール、エストニアルール

**手順**:
```
1. [仮先] 26珠型の1つを配置
2. [仮後] スワップ選択
3. [どちらか] 白4提示者か黒白決定者かの役割を選択
4. [白4提示者] 白4を打ち、黒5の題数（1〜8）を宣言
5. [黒白決定者] スワップ選択
6. [黒5提示者] 題数だけ黒5候補を提示
7. [白] 候補から1つを選び、白6を打つ
8. 以降は交互に自由に打つ
```

**特徴**:
- 白4と題数を同時に指定することで戦略の幅が広がる
- 非常に複雑で、上級者向け

**アルゴリズム実装のポイント**:
- 多段階の意思決定が必要
- 実装難易度が非常に高い

---

### 6. 五珠交代打ち（Taraguchi-10 Rule）

**対象**: 全レベル

**採用期間**: 2024年〜（現在の国際標準）

**別名**: タラグチルール、タラグチ10

**手順**:
```
1. [黒] 黒1を天元に打つ
2. [相手] スワップ選択可能
3. [白] 白2を天元から1路以内（3×3中央）に打つ
4. [相手] スワップ選択可能
5. [黒] 黒3を天元から2路以内（5×5中央）に打つ
6. [相手] スワップ選択可能
7. [白] 白4を天元から3路以内（7×7中央）に打つ
8. 以下2つの選択肢:
   A) 通常進行: 相手がスワップ選択可能、黒5を9×9内に打つ
   B) 10題オプション: 黒が黒5候補を10個提示、白が1つ選び白6を打つ
9. 以降は交互に自由に打つ
```

**特徴**:
- **毎手スワップ可能**で直感的
- 10題オプションで極端な白4を抑制
- 複雑に見えるが、実際は理解しやすい

**アルゴリズム実装のポイント**:
- スワップ判定: 各手の後に形勢評価を行い判断
  - 現在の色が有利すぎる → スワップしない（そのまま持つ）
  - 現在の色が不利 → スワップする（相手に持たせる）
- 10題オプション: 勝率のバランスが取れた10手を選択
- 盤面制限の実装: 各手で打てる範囲を制限

---

## 26珠型一覧

連珠では、黒1は天元、白2は天元から1路以内、黒3は天元から2路以内に打つため、最初の3手で26通りの形（珠型）が存在します。

### 直接打ち（13種類）
白2が黒1の縦または横に隣接する形

| 番号 | 名称 | 読み | 黒必勝 |
|------|------|------|--------|
| 1 | 寒星 | かんせい | ○ |
| 2 | 渓月 | けいげつ | ○ |
| 3 | 疎星 | そせい | △ |
| 4 | 花月 | かげつ | ○ |
| 5 | 残月 | ざんげつ | ○ |
| 6 | 雨月 | うげつ | ○ |
| 7 | 金星 | きんせい | ○ |
| 8 | 松月 | しょうげつ | ○ |
| 9 | 丘月 | きゅうげつ | ○ |
| 10 | 新月 | しんげつ | ○ |
| 11 | 瑞星 | ずいせい | ○ |
| 12 | 山月 | さんげつ | ○ |
| 13 | 遊星 | ゆうせい | △ |

### 間接打ち（13種類）
白2が黒1の斜めに隣接する形

| 番号 | 名称 | 読み | 黒必勝 |
|------|------|------|--------|
| 1 | 長星 | ちょうせい | △ |
| 2 | 峡月 | きょうげつ | △ |
| 3 | 恒星 | こうせい | △ |
| 4 | 水月 | すいげつ | △ |
| 5 | 流星 | りゅうせい | △ |
| 6 | 雲月 | うんげつ | △ |
| 7 | 浦月 | うらづき | △ |
| 8 | 岩月 | がんげつ | △ |
| 9 | 銀月 | ぎんげつ | △ |
| 10 | 名月 | めいげつ | △ |
| 11 | 彗星 | すいせい | △ |
| 12 | 明星 | みょうじょう | △ |
| 13 | 瑞星(間) | ずいせい | △ |

**凡例**: ○=黒必勝確定、△=研究中/未解明

**命名の由来**: 白石を月に、黒石を木や山などに見立てて名付けられました。

---

## 実装アルゴリズムの考察

### CPU戦への実装推奨（優先度順）

#### 1. 珠型交替五珠自由打ち（Simple Swap）★推奨
- **実装難易度**: 低
- **必要な追加実装**:
  - スワップ判定ロジック（珠型の評価）
  - スワップ選択UI
- **アルゴリズム**:
  ```
  スワップ判定(珠型) {
    黒勝率 = evaluate(珠型)
    if (黒勝率 > 0.6) return スワップして黒を取る
    if (黒勝率 < 0.4) return スワップせず白のまま
    return ランダム or 好み
  }
  ```

#### 2. 珠型交替五珠二題打ち（RIF/2題打ち）
- **実装難易度**: 中
- **必要な追加実装**:
  - 2題提示ロジック
  - 題選択UI
  - 白6手の候補選択
- **アルゴリズム**:
  ```
  2題提示(局面) {
    candidates = generateMoves(局面)
    sorted = sortByWinRate(candidates)
    // 勝率が中央付近の2手を選ぶ
    return [sorted[len/2], sorted[len/2 + 1]]
  }
  ```

#### 3. 五珠交代打ち（Taraguchi-10）
- **実装難易度**: 高
- **必要な追加実装**:
  - 毎手のスワップ判定ロジック
  - 盤面範囲制限（3×3, 5×5, 7×7, 9×9）
  - 10題オプションのロジックとUI
- **特記**: 現在の国際標準のため、将来的には対応が望ましい

---

## 現在の実装状況

### CPU戦の開局処理（`src/logic/cpuAI/opening.ts`）

```typescript
// 現在は自由打ちを実装
// 1手目: 天元
// 2手目: 天元の周囲8マスからランダム
// 3手目: 26珠型からランダム選択
```

### 実装済みの26珠型

現在、直接打ち13種類と間接打ち13種類がすでにハードコードされています。

---

## 参考資料

- [RenjuNet - Procedure of Starting the Game](https://www.renju.net/starting/)
- [RenjuNet - Soosõrv Rule](https://www.renju.net/rule/10/)
- [RenjuNet - Taraguchi Rule Discussion](https://www.renju.net/forum/thread/951/)
- [日本連珠社 - 開局規定](https://renjusha.net/about-renju/開局規定/)
- [東海連珠会 - 開局規定](http://tokai-renjukai.pya.jp/info/kaikyoku.html)
- [連珠 - Wikipedia](https://ja.wikipedia.org/wiki/連珠)

---

## 更新履歴

- 2025-01-31: 初版作成
