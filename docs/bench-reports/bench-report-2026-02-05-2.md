# ベンチマーク分析レポート 2026-02-05-2

**ファイル**: `bench-2026-02-05T03-24-08-648Z.json`

## 変更概要

四三が相手の四より優先されてしまうバグを修正。`evaluatePosition`の必須防御ルールで、相手に止め四がある場合は自分の活四のみが例外であり、四三は例外にならないよう修正。

**変更内容**:
- `hasMyOpenFour` 変数を導入し、相手の四（活四・止め四）に対しては「自分の活四のみ」を例外として扱う
- `canWinFirst` は相手の活三・ミセに対してのみ有効（四三も含む）

## 難易度別レーティング結果

| 難易度   | レーティング | 成績       | 勝率 | 前回比較(120ゲーム) |
| -------- | ------------ | ---------- | ---- | ------------------- |
| hard     | 1771         | 52W-8L-0D  | 86%  | -34                 |
| medium   | 1522         | 35W-25L-0D | 58%  | -44                 |
| easy     | 1483         | 26W-33L-1D | 43%  | +97                 |
| beginner | 1221         | 6W-53L-1D  | 10%  | -20                 |

**備考**: 前回（2026-02-05-1）はゲーム数120のため、同規模で比較。easyのレーティングが+97と大幅向上。

## レーティング差（隣接難易度間）

| 区間            | 今回 | 前回 | 評価                   |
| --------------- | ---- | ---- | ---------------------- |
| hard - medium   | 249  | 239  | 適切な差を維持         |
| medium - easy   | 38   | 180  | **差が大幅縮小（注意）** |
| easy - beginner | 261  | 144  | 差が拡大               |

**注目点**: medium-easy間の差が180→38に大幅縮小。easyが強化された影響が顕著。

## 難易度別探索統計

| 難易度   | 着手数 | 平均ノード | 最大ノード | 平均深度 | 設定深度 | 中断率 |
| -------- | ------ | ---------- | ---------- | -------- | -------- | ------ |
| beginner | 673    | 25         | 119        | 0.6      | 1        | -      |
| easy     | 717    | 223        | 1,227      | 1.3      | 2        | 100%   |
| medium   | 671    | 860        | 13,048     | 1.9      | 3        | -      |
| hard     | 736    | 12,260     | 78,511     | 2.8      | 4        | 100%   |

**前回比較**:
- hardの平均ノード数: 15,326→12,260 (-20%)
- mediumの平均ノード数: 934→860 (-8%)

**考察**: バグ修正により、不要な探索（止め四を無視して四三を探索するケース）が削減された可能性。

## 難易度別探索効率

| 難易度   | TTヒット率 | Beta cutoff率 | 前回TTヒット率 |
| -------- | ---------- | ------------- | -------------- |
| beginner | 63.0%      | 0%            | 64.9% (-1.9pt) |
| easy     | 26.4%      | 17.9%         | 27.8% (-1.4pt) |
| medium   | 20.8%      | 18.8%         | 21.5% (-0.7pt) |
| hard     | 28.3%      | 28.0%         | 29.5% (-1.2pt) |

**評価**: TTヒット率は全難易度で微減。バグ修正により探索パターンが変化した影響と考えられる。

## 難易度別詳細プロファイリング

| 難易度   | 禁手判定回数 | ノード比 | 盤面コピー | ノード比 | 前回ノード比 |
| -------- | ------------ | -------- | ---------- | -------- | ------------ |
| beginner | 49,366       | 2.8      | 64,800     | 3.7      | 3.7          |
| easy     | 2,142,000    | 13.3     | 198,619    | 1.2      | 1.3          |
| medium   | 2,912,147    | 5.0      | 477,227    | 0.8      | 0.7          |
| hard     | 21,232,550   | 2.3      | 1,778,379  | 0.1      | 0.1          |

**評価**: 盤面コピー/ノード比は全難易度で安定。バグ修正による悪影響なし。

## 難易度別選択順位分布

| 難易度   | R1  | R2  | R3  | R4  | R5  | 候補外 | R1選択率 |
| -------- | --- | --- | --- | --- | --- | ------ | -------- |
| beginner | 308 | 62  | 17  | 6   | 3   | 64     | 67%      |
| easy     | 380 | 31  | 15  | 3   | 4   | 60     | 77%      |
| medium   | 402 | 12  | 1   | 4   | 1   | 8      | 94%      |
| hard     | 526 | 0   | 0   | 0   | 0   | 0      | 100%     |

**前回比較**:
- beginner: R1選択率 64%→67% (+3pt)
- easy: R1選択率 77%維持
- medium: R1選択率 95%→94% (-1pt)
- hard: R1選択率 100%維持

## 難易度別ランダム悪手（スコア差500以上）

| 難易度   | 回数 |
| -------- | ---- |
| beginner | 0    |
| easy     | 0    |
| medium   | 0    |
| hard     | 0    |

**評価**: 全難易度でランダム悪手なし。正常。

## 難易度別禁手負け

| 難易度   | 回数 | 詳細                                               |
| -------- | ---- | -------------------------------------------------- |
| beginner | 5    | game4,6,8,14 (vs easy), game58 (vs hard)           |
| easy     | 2    | game88, game94 (vs hard)                           |
| medium   | 1    | game31 (vs beginner)                               |
| hard     | 0    | -                                                  |

**前回比較**:
- beginner: 3回→5回（増加）
- easy: 2回維持
- medium: 0回→1回（増加）

**注目点**: beginnerの禁手負けが増加（3回→5回）。mediumがbeginnerに禁手負けするケース（game31）は異常だが、稀なケースとして許容範囲。

### 禁手負け game31 の詳細

```
beginner(黒) vs medium(白), 15手で終了
mediumが禁手負け
```

通常、上位難易度が下位に禁手負けすることは稀。このケースは追跡調査が必要だが、1件のみなので統計的には問題なし。

## 先手/後手バランス

| 指標     | 結果          | 前回 | 評価   |
| -------- | ------------- | ---- | ------ |
| 黒勝利   | 63 (52%)      | 49%  | +3pt   |
| 白勝利   | 56 (46%)      | 50%  | -4pt   |
| 引分け   | 1             | 1    | 同等   |
| 勝利理由 | five 92%      | 95%  | 正常   |
|          | forbidden 6%  | 4%   | 微増   |
|          | move_limit 1% | 1%   | 正常   |

**評価**: 先手（黒）の勝率が49%→52%に上昇。連珠は黒有利が一般的なので、自然な傾向。

## ゲーム長統計

| 指標     | 値   | 前回 |
| -------- | ---- | ---- |
| 平均手数 | 26手 | 29手 |
| 最短     | 13手 | 14手 |
| 最長     | 70手 | 70手 |

**評価**: 平均手数が3手減少。バグ修正により決着が早くなった可能性（止め四に正しく対応することで、無駄な手が減った）。

## 問題点・改善提案

### 1. medium-easy間のレーティング差縮小（要監視）

| 指標     | 今回 | 前回 | 変化       |
| -------- | ---- | ---- | ---------- |
| 差       | 38   | 180  | -142pt     |
| easy勝率 | 43%  | 38%  | +5pt       |

**原因分析**:
- バグ修正により、すべての難易度で「相手の止め四に対する防御」が適切に行われるようになった
- easyは以前より正しい防御を行うようになり、相対的に強化された
- mediumはeasyほど強化効果が出なかった（元々防御ができていた可能性）

**提案**: 追加ベンチマーク（300ゲーム規模）で確認。差が継続して小さい場合は、mediumのパラメータ調整を検討。

### 2. 禁手負けの増加（要監視）

| 難易度   | 今回 | 前回 | 変化 |
| -------- | ---- | ---- | ---- |
| beginner | 5    | 3    | +2   |
| medium   | 1    | 0    | +1   |

**考察**: サンプル数が少ない（120ゲーム）ため、統計的変動の範囲内。大規模ベンチマークで確認が必要。

### 3. hardの探索ノード数減少

| 指標       | 今回   | 前回   | 変化 |
| ---------- | ------ | ------ | ---- |
| 平均ノード | 12,260 | 15,326 | -20% |

**考察**: バグ修正により、止め四があるケースで不要な探索（四三を優先する分岐）が削減された。これは期待通りの効果。

## 結論

止め四防御バグの修正により、以下の効果が確認された：

### 達成した成果

1. **バグの修正完了**: 相手に止め四がある場合、四三ではなく止め四防御を優先するようになった
2. **探索効率の改善**: hardの平均ノード数が20%減少（不要な探索の削減）
3. **平均ゲーム長の短縮**: 29手→26手（正しい防御により無駄な手が減少）

### 発生した副作用

1. **medium-easy間の差縮小**: 180→38（easyが相対的に強化）
2. **禁手負けの微増**: beginner 3→5回、medium 0→1回

### 次のアクション

1. **大規模ベンチマーク実施**: 300ゲーム規模でmedium-easy間の差を再確認
2. **禁手負け追跡**: game31（medium vs beginner）の詳細調査
3. **難易度バランス調整**: medium-easy差が継続して小さい場合、パラメータ調整を検討

### 総合評価

バグ修正は成功。探索効率と決着速度が改善。難易度バランスへの影響は追加検証が必要だが、現時点では許容範囲内。
