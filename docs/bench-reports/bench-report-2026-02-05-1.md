# ベンチマーク分析レポート 2026-02-05-1

**ファイル**: `bench-2026-02-05T01-56-28-847Z.json`

## 変更概要

VCF探索（`vcf.ts`）のUndo方式最適化を実施。`findFourMoves`, `hasVCF`, `findVCFMoveRecursive`の全てのcopyBoard呼び出しをインプレース変更+Undo方式に変更。

## 難易度別レーティング結果

| 難易度   | レーティング | 成績       | 勝率 | 前回比較 |
| -------- | ------------ | ---------- | ---- | -------- |
| hard     | 1805         | 51W-8L-1D  | 85%  | +97      |
| medium   | 1566         | 39W-21L-0D | 65%  | -47      |
| easy     | 1386         | 23W-37L-0D | 38%  | -19      |
| beginner | 1241         | 6W-53L-1D  | 10%  | -31      |

**備考**: 前回（2026-02-04-2）のベンチマークとの比較。hardのレーティングが+97と大幅向上。

## レーティング差（隣接難易度間）

| 区間            | 今回 | 前回 | 評価             |
| --------------- | ---- | ---- | ---------------- |
| hard - medium   | 239  | 94   | **差が大幅拡大** |
| medium - easy   | 180  | 208  | 適切な差を維持   |
| easy - beginner | 144  | 132  | 適切な差を維持   |

**注目点**: hard-medium間の差が94→239に大幅拡大。VCF探索の最適化によりhardの探索効率が向上し、実力差が明確になった。

## 難易度別探索統計

| 難易度   | 着手数 | 平均ノード | 最大ノード | 平均深度 | 設定深度 | 中断率 |
| -------- | ------ | ---------- | ---------- | -------- | -------- | ------ |
| beginner | 734    | 27         | 114        | 0.6      | 1        | -      |
| easy     | 781    | 201        | 1,327      | 1.3      | 2        | -      |
| medium   | 789    | 934        | 17,034     | 1.8      | 3        | -      |
| hard     | 854    | 15,326     | 81,082     | 2.9      | 4        | 100%   |

**前回比較**:

- hardの平均ノード数: 13,710→15,326 (+11.7%)
- hardの最大ノード数: 90,383→81,082（変動範囲内）
- mediumの平均ノード数: 886→934 (+5.4%)

## 難易度別探索効率

| 難易度   | TTヒット率 | Beta cutoff率 | 前回TTヒット率 |
| -------- | ---------- | ------------- | -------------- |
| beginner | 64.9%      | 0%            | 62.9% (+2.0pt) |
| easy     | 27.8%      | 18.0%         | 26.3% (+1.5pt) |
| medium   | 21.5%      | 18.4%         | 21.5% (±0)     |
| hard     | 29.5%      | 27.5%         | 28.8% (+0.7pt) |

**評価**: TTヒット率は全難易度で同水準または微増。最適化による悪影響なし。

## 難易度別詳細プロファイリング（最重要）

| 難易度   | 禁手判定回数 | ノード比 | 盤面コピー | ノード比 | 前回ノード比 |
| -------- | ------------ | -------- | ---------- | -------- | ------------ |
| beginner | 200,227      | 10.0     | 74,163     | 3.7      | 14.5         |
| easy     | 302,185      | 1.9      | 204,840    | 1.3      | 3.0          |
| medium   | 3,964,247    | 5.3      | 585,115    | **0.7**  | **20.9**     |
| hard     | 27,528,781   | 2.1      | 2,368,265  | 0.1      | 0.2          |

**最大の成果**: mediumの盤面コピー/ノード比が**20.9→0.7**に大幅削減（約97%削減）。
VCF探索のUndo方式最適化の効果が明確に表れている。

### 盤面コピー削減の詳細

| 難易度   | 前回盤面コピー | 今回盤面コピー | 削減率   |
| -------- | -------------- | -------------- | -------- |
| beginner | 262,332        | 74,163         | -71%     |
| easy     | 492,025        | 204,840        | -58%     |
| medium   | 11,735,261     | 585,115        | **-95%** |
| hard     | 2,724,343      | 2,368,265      | -13%     |

**注目点**: mediumで最も顕著な改善（95%削減）。これは前回レポートで指摘した「VCF探索での大量盤面コピー」問題が解消されたことを示す。

## 難易度別選択順位分布

| 難易度   | R1  | R2  | R3  | R4  | R5  | 候補外 | R1選択率 |
| -------- | --- | --- | --- | --- | --- | ------ | -------- |
| beginner | 322 | 82  | 23  | 7   | 6   | 63     | 64%      |
| easy     | 402 | 35  | 15  | 8   | 8   | 56     | 77%      |
| medium   | 463 | 9   | 9   | 1   | 0   | 8      | 95%      |
| hard     | 634 | 0   | 0   | 0   | 0   | 0      | 100%     |

**前回比較**:

- easy: R1選択率 74%→77% (+3pt)
- medium: R1選択率 94%→95% (+1pt)
- hard: R1選択率 100%維持

## 難易度別ランダム悪手（スコア差500以上）

| 難易度   | 回数 |
| -------- | ---- |
| beginner | 0    |
| easy     | 0    |
| medium   | 0    |
| hard     | 0    |

**評価**: 全難易度でランダム悪手なし。正常。

## 難易度別禁手負け

| 難易度   | 回数 | 詳細                                  |
| -------- | ---- | ------------------------------------- |
| beginner | 3    | game10 (vs easy), game40/54 (vs hard) |
| easy     | 2    | game84, game96 (vs hard)              |
| medium   | 0    | -                                     |
| hard     | 0    | -                                     |

**前回比較**:

- beginner: 3回（前回も3回）
- easy: 2回（前回0回、増加）
- medium: 0回（前回1回、改善）

**評価**: easyの禁手負けが増加しているが、hardに追い込まれたケースであり、難易度バランスとして適切。

## 先手/後手バランス

| 指標     | 結果          | 評価 |
| -------- | ------------- | ---- |
| 黒勝利   | 59 (49%)      | 正常 |
| 白勝利   | 60 (50%)      | 正常 |
| 引分け   | 1             | 正常 |
| 勝利理由 | five 95%      | 正常 |
|          | forbidden 4%  | 正常 |
|          | move_limit 1% | 正常 |

**評価**: 先手/後手バランスは完璧に近い（49:50）。理想的な状態。

## ゲーム長統計

| 指標     | 値   | 前回 |
| -------- | ---- | ---- |
| 平均手数 | 29手 | 26手 |
| 最短     | 14手 | 13手 |
| 最長     | 70手 | 62手 |

**評価**: 平均手数が3手増加。より長い対局が増えている。

## 問題点・改善提案

### 1. 全ての主要目標を達成

前回レポートで提案した「VCF探索のUndo方式最適化」を完了:

- mediumの盤面コピー/ノード比: 20.9 → 0.7（-96%）
- hardの平均ノード数: +11.7%増加
- hard-medium間のレーティング差: 94 → 239（明確な階層化）

### 2. 残存する軽微な懸念

**hardの中断率100%について**:

- 設定深度4に到達するケースが増加（1件→633件）
- 中断率は依然100%だが、探索効率は向上
- **提案**: 現状維持。必要であればtimeLimit増加を検討

### 3. 今後の最適化候補

| 項目              | 現状     | 改善案               |
| ----------------- | -------- | -------------------- |
| 脅威検出/ノード比 | 0.1-0.3  | 最適化の余地あり     |
| 禁手判定/ノード比 | 2.1-10.0 | beginnerで高め       |
| TTヒット率        | 21-65%   | サイズ増加で改善可能 |

## 結論

VCF探索のUndo方式最適化により、以下の改善が確認された:

### 達成した成果

1. **mediumの盤面コピー問題解消**: ノード比20.9→0.7（96%削減）
2. **hardの探索効率向上**: 平均ノード数+11.7%、レーティング+97
3. **難易度階層の明確化**: hard-medium間の差が94→239に拡大
4. **先手/後手バランス改善**: 52:47→49:50（ほぼ完璧）

### 技術的改善

- `vcf.ts`から`copyBoard`のimportを完全削除
- 全てのVCF探索関数がインプレース変更+Undo方式に対応
- 探索効率の向上により、同一時間でより深い探索が可能に

### 次のアクション

1. 現状の安定動作を確認するため、追加ベンチマークの実施を検討
2. 必要に応じてhardのtimeLimit調整
3. 脅威検出や禁手判定の更なる最適化を検討
