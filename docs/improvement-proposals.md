# 改善提案

ソース: [weakness-report-2026-02-11-2](bench-reports/weakness-report-2026-02-11-2.md)

## 分析ツール改善（ゲームAIへの影響なし）

| 優先度 | 対象                        | 提案                                               | 想定効果                               |
| ------ | --------------------------- | -------------------------------------------------- | -------------------------------------- |
| **1**  | TPE検出器改善               | `timePressureFallback` フラグを読んでTPEから除外   | 見かけ上のTPE 27件→実質2件に           |
| **2**  | forbidden-vulnerability分類 | `forcedForbidden` フラグで禁手追い込みを正しく分類 | 10件を「正常な禁手追い込み」として除外 |
| **3**  | TPE閾値微調整               | WINNING_SCORE_THRESHOLD=2000→1900                  | 未発動2件をカバー                      |
| **4**  | blunder閾値                 | 検出閾値を2000→3000に引き上げてファントム振動除外  | 実質blunderに集中（367→~113件）        |

## ゲームAI改善

| 優先度 | 対象                               | 提案                         | 想定効果           |
| ------ | ---------------------------------- | ---------------------------- | ------------------ |
| **5**  | advantage-squandered (VCF実行失敗) | VCF検出後の実行パスの検証    | 7件の削減          |
| **6**  | 禁手追い込み予防                   | 探索レベルでの禁手脆弱性検出 | 禁手負け10件の削減 |

## コード品質改善（NMP偽五連・跳び四修正のレビューより）

ソース: 2026-02-23 レビュー（SOLID・パフォーマンス・イシュー）

### SOLID

| 対象                              | 提案                                                                                                                                         | 詳細                                                           |
| --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------- |
| `isOpenThreePattern` ヘルパー抽出 | 跳び四除外付きの活三判定ロジックが3箇所に重複（`threatDetection.ts`、`hasOpenThree`、`getCreatedOpenThreeDefenses`）。共通ヘルパーに抽出する | DRY原則。現在は `checkJumpFour` を各箇所で個別に呼び出している |
| `bypassVctThreshold` パラメータ   | `evaluatePlayedForcedWin` の `bypassVctThreshold?: boolean` を、意図が明確な名前やオプションオブジェクトに変更する                           | 例: `{ forceVctSearch: true }` など                            |

### パフォーマンス

| 対象                          | 提案                                                                    | 詳細                                                       |
| ----------------------------- | ----------------------------------------------------------------------- | ---------------------------------------------------------- |
| `classifyThreat` の跳び四確認 | `threatMoves.ts` の `classifyThreat` にも同じ跳び四問題がないか確認する | 影響は低いが整合性のため。探索パフォーマンスへの影響はなし |

### イシュー

| 対象                             | 提案                                                                                      | 詳細                                                                             |
| -------------------------------- | ----------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------- |
| 跳び四除外のユニットテスト       | `hasOpenThree` / `getCreatedOpenThreeDefenses` の跳び四除外に直接ユニットテストを追加する | 現在は統合テスト（iterativeDeepening）でのみカバー                               |
| VCT リトライのコメント更新       | `review.worker.ts` のVCTリトライコメントを、NMP修正後の実態に合わせて更新する             | NMP修正後も石数 < 14 のケースではVCTがスキップされるため、リトライ自体は依然有効 |
| `countThreatDirections` の整合性 | 跳び四を含むラインの脅威方向カウントが正しいか確認する                                    | `threatDetection.ts` の活三カウントと整合性を取る                                |
